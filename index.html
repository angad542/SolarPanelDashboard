<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Solar Panel Dashboard</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background-color: #f8f8f8;
            color: #333;
        }

        /* Header */
        .header {
            background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%);
            border-bottom: 2px solid #34495e;
            padding: 15px 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            z-index: 1000;
            height: 60px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        .header-left {
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .logo {
            font-size: 18px;
            font-weight: bold;
            color: white;
            text-shadow: 0 1px 2px rgba(0, 0, 0, 0.3);
        }

        .nav-tabs {
            display: flex;
            gap: 8px; /* Reduced gap for narrower navbar */
        }

        .nav-tab {
            padding: 6px 10px; /* Reduced padding for narrower tabs */
            background: none; /* Remove background */
            border: none; /* Remove border */
            border-radius: 0; /* Remove border radius */
            cursor: pointer;
            transition: color 0.3s ease;
            color: white;
            font-weight: 500;
        }

        .nav-tab:hover {
            background: none;
            color: #d0e6fa;
            transform: none;
        }

        .nav-tab.active {
            background: none;
            color: #ffd700;
            box-shadow: none;
        }

        .header-right {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
            color: white;
        }

        .notification-icon {
            width: 24px;
            height: 24px;
            background: linear-gradient(135deg, #e74c3c, #c0392b);
            border-radius: 50%;
            position: relative;
            cursor: pointer;
            box-shadow: 0 2px 6px rgba(231, 76, 60, 0.3);
        }

        .notification-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background-color: #e74c3c;
            color: white;
            border-radius: 50%;
            width: 16px;
            height: 16px;
            font-size: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            border: 2px solid white;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            top: 60px;
            left: 0;
            width: 180px; /* Reduced width */
            height: calc(100vh - 60px);
            background: linear-gradient(180deg, #34495e 0%, #2c3e50 100%);
            border-right: 2px solid #34495e;
            overflow-y: auto;
            z-index: 999;
            box-shadow: 2px 0 10px rgba(0, 0, 0, 0.1);
        }

        .sidebar-item {
            padding: 12px 12px; /* Reduced padding */
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px; /* Reduced gap */
            transition: all 0.3s ease;
            color: #ecf0f1;
            font-size: 14px; /* Reduce font size for better fit */
            padding: 10px 10px;
            gap: 8px;
        }

        .sidebar-item:hover {
            background-color: rgba(52, 152, 219, 0.2);
            padding-left: 25px;
        }

        .sidebar-item.active {
            background: linear-gradient(135deg, #3498db, #2980b9);
            color: white;
            border-left: 4px solid #2980b9;
            box-shadow: inset 0 0 20px rgba(0, 0, 0, 0.1);
        }

        .sidebar-icon {
            width: 18px;
            height: 18px;
            background-color: #7f8c8d; /* Restore box background */
            border-radius: 3px;
            transition: all 0.3s ease;
            box-shadow: none;
        }

        .sidebar-item.active .sidebar-icon {
            background-color: white;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .sidebar-item:hover .sidebar-icon {
            background-color: #3498db;
        }

        .sidebar-item.active .sidebar-icon {
            background-color: transparent; /* No white background for active */
            box-shadow: none;
        }

        /* Main Content */
        .main-content {
            margin-left: 180px; /* Match reduced sidebar width */
            margin-top: 60px;
            padding: 20px;
            min-height: calc(100vh - 60px);
        }

        /* Top Stats Bar */
        .stats-bar {
            background-color: white;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Main Chart Container */
        .main-chart-container {
            background-color: white;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            padding: 20px;
            margin-bottom: 20px;
            height: 400px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Two Column Layout */
        .two-column-layout {
            display: grid;
            grid-template-columns: 1fr 240px;
            gap: 20px;
            margin-bottom: 20px;
            align-items: stretch;
        }

        .flowchart-container {
            width: 100%;
            flex: none;
            min-width: 0;
            min-height: 600px;
            background-color: white;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            padding: 0;
            height: auto;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
        }

        .weather-container {
            width: 240px;
            min-width: 180px;
            max-width: none;
            min-height: 600px;
            background-color: white;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            padding: 0;
            height: auto;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            display: flex;
            flex-direction: column;
            justify-content: center;
            justify-self: end;
        }

        /* Final Chart Container */
        .final-chart-container {
            background-color: white;
            border: 1px solid #d0d0d0;
            border-radius: 8px;
            padding: 32px;
            min-height: 500px;
            height: auto;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }

        /* Responsive Design */
        @media (max-width: 768px) {
            .sidebar {
                transform: translateX(-100%);
                transition: transform 0.3s ease;
            }

            .sidebar.mobile-open {
                transform: translateX(0);
            }

            .main-content {
                margin-left: 0;
            }

            .two-column-layout {
                flex-direction: column;
            }

            .flowchart-container,
            .weather-container {
                flex: 1;
                height: 300px;
            }

            .header-left .nav-tabs {
                display: none;
            }

            .mobile-menu-btn {
                display: block;
                background: none;
                border: none;
                font-size: 20px;
                cursor: pointer;
            }
        }

        @media (max-width: 1200px) {
            .flowchart-container, .weather-container {
                min-width: 300px;
                min-height: 400px;
                padding: 16px;
            }
            .final-chart-container {
                min-height: 350px;
                padding: 16px;
            }
        }

        @media (max-width: 900px) {
            .two-column-layout {
                display: flex;
                flex-direction: column;
            }
            .flowchart-container, .weather-container {
                width: 100%;
                min-width: 0;
                margin-bottom: 20px;
            }
            .weather-container {
                width: 100%;
                max-width: none;
                justify-self: auto;
            }
        }

        .mobile-menu-btn {
            display: none;
        }

        /* Placeholder styling */
        .placeholder {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #999;
            font-size: 14px;
            border: 2px dashed #d0d0d0;
            border-radius: 4px;
        }

        .flow-flow-chart-container {
            width: 100%;
            height: 100%;
            background: white;
            border-radius: 8px;
            padding: 0;
            margin: 0;
            box-shadow: none;
            display: flex;
            flex-direction: column;
            justify-content: stretch;
        }
        .flow-flow-chart {
            display: grid;
            grid-template-columns: 200px 1fr 200px;
            grid-template-rows: 100px 100px 100px 100px;
            gap: 20px;
            min-height: 400px;
            height: 100%;
            align-items: stretch;
            position: relative;
        }
        .flow-production, .flow-grid-section {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 8px;
        }
        .flow-flow-label {
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        .flow-house {
            grid-column: 2;
            grid-row: 2;
            display: flex;
            justify-content: center;
            align-items: center;
        }
        .flow-consumption {
            grid-column: 2;
            grid-row: 4;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 15px;
        }
        .flow-flow-icon { width: 60px; height: 60px; border-radius: 8px; object-fit: cover; }
        .flow-flow-chart-title {
            font-size: 18px;
            font-weight: bold;
            color: #333;
            margin-bottom: 20px;
        }
        .flow-flow-title {
            font-size: 16px;
            font-weight: 500;
            color: #374151;
            margin-bottom: 4px;
        }
        .flow-flow-value { font-size: 14px; font-weight: bold; color: #6b7280; }
        .flow-connection-lines { position: absolute; top: 0; left: 0; width: 100%; height: 100%; pointer-events: none; }
        .flow-line { position: absolute; background: #9ca3af; transition: background-color 0.3s ease; }
        .flow-line-horizontal { height: 3px; }
        .flow-line-vertical { width: 3px; }
        .flow-line-prod-house {
            top: 49px;
            left: 215px;
            width: calc(50% - 255px);
        }
        .flow-line-house-grid {
            top: 49px;
            left: calc(50% + 40px);
            width: calc(50% - 255px);
        }
        .flow-line-house-consumption {
            top: 220px;
            left: 50%;
            transform: translateX(-50%);
            height: 110px;
        }
        .flow-connection-dot { position: absolute; width: 12px; height: 12px; background: #9ca3af; border-radius: 50%; transform: translate(-50%, -50%); transition: background-color 0.3s ease; }
        .flow-dot-prod {
            top: 51px;
            left: 215px;
        }
        .flow-dot-house-left {
            top: 51px;
            left: calc(50% - 40px);
        }
        .flow-dot-house-right {
            top: 51px;
            left: calc(50% + 40px);
        }
        .flow-dot-grid {
            top: 51px;
            left: calc(100% - 215px);
        }
        .flow-dot-house-bottom { top: 220px; left: 50%; }
        .flow-dot-consumption-top { top: 330px; left: 50%; }
        .flow-arrow { position: absolute; font-size: 20px; color: white; font-weight: bold; text-shadow: 1px 1px 2px rgba(0,0,0,0.5); display: none; }
        .flow-arrow.show { display: block; }
        .flow-arrow-prod-house { top: 72px; left: 30%; transform: translateX(-50%); }
        .flow-arrow-house-grid { top: 72px; left: 70%; transform: translateX(-50%); }
        .flow-arrow-house-consumption { top: calc(220px + 55px); left: 50%; transform: translateX(-50%); }
        .flow-grid-section {
            grid-column: 3;
            grid-row: 1;
            display: flex;
            align-items: center;
            justify-content: flex-end;
            gap: 15px;
        }

        .weather-widget {
            background: white;
            border-radius: 16px;
            padding: 10px;
            box-shadow: 0 4px 2px rgba(0, 0, 0, 0.1);
            width: 100%;
            height: 100%;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        .weather-header h1 { font-size: 20px; font-weight: 600; color: #333; }
        .weather-update-info { display: flex; align-items: center; gap: 6px; color: #999; font-size: 12px; }
        .weather-today-weather {
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 24px;
            padding: 18px 0 24px 0;
        }
        .weather-location { font-size: 16px; color: #666; font-weight: 500; }
        .weather-main-weather {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 18px;
        }
        .weather-temperature { font-size: 48px; font-weight: 200; color: #333; line-height: 1; }
        .weather-weather-status { display: flex; align-items: center; gap: 8px; }
        .weather-weather-icon { font-size: 20px; }
        .weather-condition-temp { display: flex; flex-direction: column; align-items: flex-start; gap: 2px; }
        .weather-condition-temp span:first-child { font-size: 16px; color: #333; font-weight: 500; }
        .weather-condition-temp span:last-child { font-size: 12px; color: #666; }
        .weather-sun-info { display: flex; justify-content: center; gap: 20px; margin-top: 6px; }
        .weather-sun-time { display: flex; flex-direction: column; align-items: center; gap: 4px; }
        .weather-sun-time .label { color: #666; font-size: 10px; font-weight: 500; }
        .weather-sun-time span:last-child { color: #333; font-weight: 600; font-size: 12px; }
        .weather-forecast-section { border-top: 1px solid #e5e5e5; padding-top: 10px; }
        .weather-forecast-columns {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }
        .weather-forecast-column {
            flex: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            gap: 4px;
            padding: 12px 2px;
            border-radius: 8px;
            transition: background-color 0.2s;
        }
        .weather-forecast-column + .weather-forecast-column {
            border-top: 1px solid #e0e0e0;
        }
        .weather-forecast-column:hover { background-color: #f8f9fa; }
        .weather-day-name { font-size: 10px; color: #666; font-weight: 500; line-height: 1.2; }
        .weather-day-condition { font-size: 12px; color: #333; font-weight: 500; }
        .weather-day-temp { font-size: 10px; color: #666; font-weight: 500; }

        /* 24h Curve and Historical Data Section Styles */
        .chart-container {
            background: white;
            border-radius: 12px;
            padding: 20px;
            margin-bottom: 20px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
        }
        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            flex-wrap: wrap;
            gap: 15px;
        }
        .chart-title {
            font-size: 20px;
            font-weight: bold;
            color: #333;
        }
        .chart-controls {
            display: flex;
            gap: 10px;
            align-items: center;
            flex-wrap: wrap;
        }
        .date-selector {
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 6px;
            background: white;
            font-size: 14px;
            color: #333;
        }
        .legend {
            display: flex;
            gap: 30px;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        .legend-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 14px;
            color: #666;
        }
        .legend-dot {
            width: 12px;
            height: 12px;
            border-radius: 50%;
        }
        .legend-dot.production {
            background: #2196f3;
        }
        .legend-dot.consumption {
            background: #f44336;
        }
        .chart-wrapper {
            position: relative;
            height: 400px;
        }
        .summary-cards {
            display: flex;
            gap: 20px;
            margin-top: 20px;
        }
        .summary-card {
            background: #f5f7fa;
            border-radius: 10px;
            padding: 18px 24px;
            flex: 1;
            min-width: 180px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
        }
        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 8px;
        }
        .card-header h3 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
        }
        .card-value {
            font-size: 20px;
            font-weight: bold;
            color: #1976d2;
        }
        .card-progress {
            background: #e3eafc;
            border-radius: 6px;
            height: 8px;
            margin: 10px 0;
            width: 100%;
            overflow: hidden;
        }
        .progress-bar {
            height: 100%;
            border-radius: 6px;
        }
        .production-progress {
            background: #2196f3;
        }
        .consumption-progress {
            background: #f44336;
        }
        .card-detail {
            font-size: 13px;
            color: #666;
        }
        .card-footer {
            font-size: 12px;
            color: #888;
            margin-top: 6px;
        }
        /* Historical Data Section Styles */
        .final-chart-container {
            background-color: white;
            border: 1px solid #d0d0d0;
            border-radius: 12px;
            padding: 24px;
            min-height: 500px;
            margin-top: 24px;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
        }
        .hist-header {
            display: flex;
            flex-direction: column;
            align-items: flex-start;
            margin-bottom: 16px;
        }
        .hist-title {
            font-size: 24px;
            font-weight: bold;
            color: #333;
            margin-bottom: 8px;
        }
        .controls {
            display: flex;
            gap: 20px;
            align-items: center;
            flex-wrap: wrap;
        }
        .date-nav {
            display: flex;
            align-items: center;
            gap: 8px;
        }
        .nav-btn {
            background: #e3eafc;
            border: none;
            border-radius: 4px;
            padding: 4px 10px;
            font-size: 16px;
            cursor: pointer;
            color: #1976d2;
        }
        .date-display {
            font-size: 16px;
            font-weight: 500;
            color: #333;
        }
        .view-toggle {
            display: flex;
            gap: 8px;
        }
        .view-btn {
            background: #f5f7fa;
            border: 1px solid #d0d0d0;
            border-radius: 4px;
            padding: 4px 12px;
            font-size: 14px;
            cursor: pointer;
            color: #1976d2;
            transition: background 0.2s;
        }
        .view-btn.active {
            background: #1976d2;
            color: white;
        }
        .parameters {
            margin-bottom: 12px;
        }
        .parameters h3 {
            font-size: 16px;
            font-weight: 600;
            color: #333;
            margin-bottom: 8px;
        }
        .parameter-grid {
            display: flex;
            flex-wrap: wrap;
            gap: 12px 24px;
        }
        .parameter-item {
            display: flex;
            align-items: center;
            gap: 6px;
        }
        .parameter-checkbox {
            accent-color: #1976d2;
        }
        .parameter-label {
            font-size: 14px;
            color: #555;
            display: flex;
            align-items: center;
            gap: 4px;
        }
        .chart-container .chart-wrapper, .final-chart-container .chart-wrapper {
            position: relative;
            height: 400px;
        }
        @media (max-width: 900px) {
            .summary-cards { flex-direction: column; gap: 12px; }
            .final-chart-container { padding: 12px; }
        }
        .delete-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            display: none;
            justify-content: center;
            align-items: center;
            z-index: 1000;
            opacity: 0;
            transition: opacity 0.3s ease;
        }

        .delete-modal-overlay.active {
            display: flex;
            opacity: 1;
        }

        .delete-modal-container {
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            max-width: 400px;
            width: 90%;
            transform: translateY(-50px);
            transition: transform 0.3s ease;
        }

        .delete-modal-overlay.active .delete-modal-container {
            transform: translateY(0);
        }

        .delete-modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px;
            border-bottom: 1px solid #eee;
        }

        .delete-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #2c3e50;
            margin: 0;
        }

        .delete-modal-close {
            background: none;
            border: none;
            font-size: 24px;
            color: #95a5a6;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: all 0.3s ease;
        }

        .delete-modal-close:hover {
            background-color: #ecf0f1;
            color: #2c3e50;
        }

        .delete-modal-body {
            padding: 20px;
        }

        .delete-modal-message {
            color: #7f8c8d;
            line-height: 1.5;
            margin: 0 0 20px 0;
        }

        .delete-modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .delete-modal-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            transition: all 0.3s ease;
        }

        .delete-modal-btn-cancel {
            background-color: #ecf0f1;
            color: #2c3e50;
            border: 1px solid #bdc3c7;
        }

        .delete-modal-btn-cancel:hover {
            background-color: #d5dbdb;
        }

        .delete-modal-btn-confirm {
            background-color: #e74c3c;
            color: white;
        }

        .delete-modal-btn-confirm:hover {
            background-color: #c0392b;
        }

        /* Prevent body scroll when modal is open */
        .settings-modal-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0, 0, 0, 0.5);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }

        .settings-modal {
            background: white;
            border-radius: 8px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            width: 90%;
            max-width: 600px;
            position: relative;
            animation: settingsSlideIn 0.3s ease-out;
        }

        @keyframes settingsSlideIn {
            from {
                opacity: 0;
                transform: translateY(-20px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
        body.modal-open {
            overflow: hidden;
        }
        .settings-modal-header {
            padding: 20px 24px;
            border-bottom: 1px solid #e5e7eb;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .settings-modal-title {
            font-size: 18px;
            font-weight: 600;
            color: #1f2937;
            margin: 0;
        }

        .settings-close-button {
            background: none;
            border: none;
            font-size: 24px;
            color: #6b7280;
            cursor: pointer;
            padding: 0;
            width: 24px;
            height: 24px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .settings-close-button:hover {
            background-color: #f3f4f6;
            color: #374151;
        }

        .settings-modal-body {
            padding: 24px;
        }

        .settings-item {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 16px 0;
            border-bottom: 1px solid #f3f4f6;
        }

        .settings-item:last-child {
            border-bottom: none;
        }

        .settings-item-left {
            flex: 1;
        }

        .settings-item-title {
            font-size: 16px;
            font-weight: 500;
            color: #1f2937;
            margin-bottom: 4px;
        }

        .settings-item-subtitle {
            font-size: 14px;
            color: #6b7280;
        }

        .settings-item-right {
            margin-left: 16px;
        }

        .settings-revise-button {
            background: none;
            border: none;
            color: #3b82f6;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            padding: 8px 16px;
            border-radius: 4px;
            transition: all 0.2s ease;
        }

        .settings-revise-button:hover {
            background-color: #eff6ff;
            color: #2563eb;
        }

        .settings-modal-footer {
            padding: 20px 24px;
            border-top: 1px solid #e5e7eb;
            display: flex;
            justify-content: flex-end;
        }

        .settings-authorize-button {
            background-color: #3b82f6;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 6px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
        }

        .settings-authorize-button:hover {
            background-color: #2563eb;
        }

        .plant-select-btn {
          background: #fff;
          color: #1976d2;
          border: 2px solid #1976d2;
          border-radius: 50px;
          width: 100%;
          padding: 6px 0;
          margin-bottom: 12px;
          font-size: 15px;
          font-weight: 500;
          cursor: pointer;
          transition: background 0.2s, color 0.2s;
          box-shadow: 0 2px 8px rgba(25, 118, 210, 0.04);
        }
        .plant-select-btn.selected, .plant-select-btn:active {
          background: #1976d2;
          color: #fff;
          border: 2px solid #1976d2;
        }
        .plant-select-btn:hover {
          background: #e3eafc;
          color: #1565c0;
          border: 2px solid #1565c0;
        }
        #plantList {
          max-height: 320px;
          overflow-y: auto;
          padding-right: 4px;
        }

    </style>
</head>
<body>
    <style>
        .microtek-header { background: linear-gradient(135deg, #3498db 0%, #2c3e50 100%); border-bottom: 2px solid #34495e; padding: 15px 20px; display: flex; justify-content: space-between; align-items: center; position: fixed; top: 0; left: 0; right: 0; z-index: 1000; height: 60px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .microtek-header-left { display: flex; align-items: center; gap: 20px; }
        .microtek-logo { font-size: 18px; font-weight: bold; color: white; text-shadow: 0 1px 2px rgba(0,0,0,0.3); }
        .microtek-nav-tabs { display: flex; gap: 8px; }
        .microtek-nav-tab { padding: 6px 10px; background: none; border: none; border-radius: 0; cursor: pointer; transition: color 0.3s ease; color: white; font-weight: 500; }
        .microtek-nav-tab:hover { background: none; color: #d0e6fa; transform: none; }
        .microtek-nav-tab.active { background: none; color: #ffd700; box-shadow: none; }
        .microtek-header-right { display: flex; align-items: center; gap: 15px; }
        .microtek-user-info { display: flex; align-items: center; gap: 10px; color: white; }
        .microtek-notification-icon { width: 24px; height: 24px; background: linear-gradient(135deg, #e74c3c, #c0392b); border-radius: 50%; position: relative; cursor: pointer; box-shadow: 0 2px 6px rgba(231,76,60,0.3); }
        .microtek-notification-badge { position: absolute; top: -5px; right: -5px; background-color: #e74c3c; color: white; border-radius: 50%; width: 16px; height: 16px; font-size: 10px; display: flex; align-items: center; justify-content: center; border: 2px solid white; }
        .microtek-sidebar { position: fixed; top: 60px; left: 0; width: 180px; height: calc(100vh - 60px); background: linear-gradient(180deg, #34495e 0%, #2c3e50 100%); border-right: 2px solid #34495e; overflow-y: auto; z-index: 999; box-shadow: 2px 0 10px rgba(0,0,0,0.1); }
        .microtek-sidebar-item { padding: 10px 10px; border-bottom: 1px solid rgba(255,255,255,0.1); cursor: pointer; display: flex; align-items: center; gap: 8px; transition: all 0.3s ease; color: #ecf0f1; font-size: 14px; }
        .microtek-sidebar-item:hover { background-color: rgba(52,152,219,0.2); padding-left: 25px; }
        .microtek-sidebar-item.active {
            background: white !important;
            color: #1976d2 !important;
            border-left: 4px solid #2980b9;
            box-shadow: inset 0 0 20px rgba(0,0,0,0.1);
        }
        .microtek-sidebar-item.active .microtek-sidebar-icon {
            background-color: #1976d2 !important;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }
        .microtek-sidebar-item:hover .microtek-sidebar-icon { background-color: #3498db; }
        .microtek-main-content { margin-left: 180px; margin-top: 60px; padding: 20px; min-height: calc(100vh - 60px); }
        </style>
        <div class="microtek-header">
          <div class="microtek-header-left">
            <div class="microtek-logo" onclick="window.location.href='index.html'"><img src="./assets/microteklogosvg.svg" alt="MICROTEK"></div>
            <div class="microtek-nav-tabs">
              <button class="microtek-nav-tab">My Plant</button>
              <button class="microtek-nav-tab" onclick="window.location.href='function.html'">Function</button>
            </div>
          </div>
          <div class="microtek-header-right">
            <div class="microtek-user-info">
              <button class="microtek-nav-tab" onclick="window.open('manual.html','_blank')">User Manual</button>
              <div class="microtek-notification-icon" onclick="window.location.href='alerts.html'">
                <div class="microtek-notification-badge">1</div>
              </div>
              <button class="microtek-nav-tab" onclick="window.location.href='profile.html'">Microtek123</button>
            </div>
          </div>
        </div>
        <div class="microtek-sidebar" id="microtek-sidebar" style="display: flex; flex-direction: column; height: calc(100vh - 60px);">
          <div class="microtek-sidebar-item" onclick="window.location.href='create.html'"><div class="microtek-sidebar-icon"></div><span>Create Plant</span></div>
          <div class="microtek-sidebar-item" onclick="window.location.href='logger.html'"><div class="microtek-sidebar-icon"></div><span>Add a Logger</span></div>
          <div class="microtek-sidebar-item active" onclick="window.location.href='index.html'"><div class="microtek-sidebar-icon"></div><span>Overview</span></div>
          <div class="microtek-sidebar-item" onclick="window.location.href='plantdetails.html'"><div class="microtek-sidebar-icon"></div><span>Plant Details</span></div>
          <div class="microtek-sidebar-item" onclick="window.location.href='devices.html'"><div class="microtek-sidebar-icon"></div><span>Device</span></div>
          <div class="microtek-sidebar-item" onclick="window.location.href='alerts.html'"><div class="microtek-sidebar-icon"></div><span>Alerts</span></div>
          <div class="microtek-sidebar-item" onclick="window.location.href='export.html'"><div class="microtek-sidebar-icon"></div><span>Export</span></div>
          <div class="microtek-sidebar-item" onclick="openSettingsModal()"><div class="microtek-sidebar-icon"></div><span>Plant Settings</span></div>
          <div class="microtek-sidebar-item" onclick="showDeleteModal()"><div class="microtek-sidebar-icon"></div><span>Delete</span></div>
          <div style="flex:1"></div>
          <div class="microtek-sidebar-item" onclick="openSwitchPlantModal()" id="switchPlantSidebarBtn">
            <div class="microtek-sidebar-icon"></div>
            <span>Switch Plant</span>
          </div>
        </div>
        <!-- Switch Plant Modal -->
        <div id="switchPlantModal" style="display:none; position:fixed; left:0; top:0; width:100vw; height:100vh; background:rgba(0,0,0,0.3); z-index:9999; align-items:center; justify-content:center;">
          <div style="background:#fff; padding:30px; border-radius:10px; min-width:300px;">
            <h3>Choose a Plant</h3>
            <ul id="plantList" style="list-style:none; padding:0;"></ul>
            <button onclick="closeSwitchPlantModal()" class="btn-primary" style="margin-top:10px;">Close</button>
          </div>
        </div>
        <script>
        let selectedPlantBtn = null;
        function openSwitchPlantModal() {
            const plants = ['Delhi Solar Park', 'Mumbai Rooftop', 'Chennai Sunfields', 'Ahmedabad GreenGrid', 'Bangalore Powerhouse', 'Kolkata Rays', 'Hyderabad Surya', 'Pune Ujjwal', 'Jaipur Shakti', 'Lucknow Urja'];
            const plantList = document.getElementById('plantList');
            plantList.innerHTML = '';
            selectedPlantBtn = null;
            plants.forEach(name => {
                const li = document.createElement('li');
                li.style.margin = '10px 0';
                const btn = document.createElement('button');
                btn.className = 'plant-select-btn';
                btn.textContent = name;
                btn.onclick = function() {
                    if(selectedPlantBtn) selectedPlantBtn.classList.remove('selected');
                    btn.classList.add('selected');
                    selectedPlantBtn = btn;
                    selectPlant(name);
                };
                li.appendChild(btn);
                plantList.appendChild(li);
            });
            document.getElementById('switchPlantModal').style.display = 'flex';
        }
        function closeSwitchPlantModal() {
            document.getElementById('switchPlantModal').style.display = 'none';
        }
        function selectPlant(name) {
            if(name==='Mumbai Rooftop') window.location.href='mumbaiPlant.html';
        }
        </script>
    <!-- Main Content -->
    <div class="microtek-main-content">
        <!-- Top Stats Bar -->
        <div class="stats-bar">
            <style>
                .orig-stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 20px; }
                .orig-stat-card { text-align: center; padding: 10px; }
                .orig-stat-label { font-size: 14px; color: #666; margin-bottom: 8px; }
                .orig-stat-value { font-size: 20px; font-weight: bold; color: #1976d2; }
            </style>
            <div class="orig-stats-grid">
                <div class="orig-stat-card">
                    <div class="orig-stat-label">Total Production</div>
                    <div class="orig-stat-value" id="orig-totalProduction">153.66MWh</div>
                </div>
                <div class="orig-stat-card">
                    <div class="orig-stat-label">Self-used Ratio</div>
                    <div class="orig-stat-value" id="orig-selfUsedRatio">96.96%</div>
                </div>
                <div class="orig-stat-card">
                    <div class="orig-stat-label">Total Grid Feed-in</div>
                    <div class="orig-stat-value" id="orig-totalGridFeed">4.56MWh</div>
                </div>
                <div class="orig-stat-card">
                    <div class="orig-stat-label">Anticipated Yield</div>
                    <div class="orig-stat-value" id="orig-anticipatedYield">113.67M AUD</div>
                </div>
                <div class="orig-stat-card">
                    <div class="orig-stat-label">Running Days</div>
                    <div class="orig-stat-value" id="orig-runningDays">339</div>
                </div>
                <div class="orig-stat-card">
                    <div class="orig-stat-label">CO₂ Prevented</div>
                    <div class="orig-stat-value" id="orig-co2Prevented">126t</div>
                </div>
            </div>
        </div>

        <!-- 24h Curve Chart Section (Faithful Integration) -->
        <div class="chart-container">
            <div class="chart-header">
                <h2 class="chart-title">24h Curve</h2>
                <div class="chart-controls">
                    <input type="date" class="date-selector" id="dateSelector" value="2024-01-01">
                </div>
            </div>
            <div class="legend">
                <div class="legend-item">
                    <span class="legend-dot production"></span>
                    Production Power
                </div>
                <div class="legend-item">
                    <span class="legend-dot consumption"></span>
                    Consumption Power
                </div>
            </div>
            <div class="chart-wrapper">
                <canvas id="powerChart"></canvas>
            </div>
            <div class="summary-cards">
                <div class="summary-card">
                    <div class="card-header">
                        <h3>Total Production</h3>
                        <div class="card-value" id="totalProduction">394.62 kWh</div>
                    </div>
                    <div class="card-progress">
                        <div class="progress-bar production-progress" style="width: 78%"></div>
                    </div>
                    <div class="card-detail">12h01:27 min</div>
                </div>
                <div class="summary-card">
                    <div class="card-header">
                        <h3>Total Consumption</h3>
                        <div class="card-value" id="totalConsumption">59.99 kWh</div>
                    </div>
                    <div class="card-progress">
                        <div class="progress-bar consumption-progress" style="width: 45%"></div>
                    </div>
                    <div class="card-detail">12h01:52 min</div>
                </div>
            </div>
        </div>

        <!-- Two Column Layout (Flowchart + Weather) -->
        <div class="two-column-layout">
            <!-- Flowchart Container (65%) -->
            <div class="flowchart-container">
                <style>
                    .flow-chart {
                        display: grid;
                        grid-template-columns: 200px 1fr 200px;
                        grid-template-rows: 100px 100px 100px 100px;
                        gap: 20px;
                        min-height: 400px;
                        position: relative;
                        width: 100%;
                        max-width: 100%;
                    }
                    .production {
                        grid-column: 1;
                        grid-row: 1;
                        display: flex;
                        align-items: center;
                        gap: 15px;
                    }
                    .house {
                        grid-column: 2;
                        grid-row: 2;
                        display: flex;
                        justify-content: center;
                        align-items: center;
                    }
                    .consumption {
                        grid-column: 2;
                        grid-row: 4;
                        display: flex;
                        flex-direction: column;
                        align-items: center;
                        gap: 15px;
                    }
                    .grid-section {
                        grid-column: 3;
                        grid-row: 1;
                        display: flex;
                        align-items: center;
                        justify-content: flex-end;
                        gap: 15px;
                    }
                    .flow-icon {
                        width: 60px;
                        height: 60px;
                        border-radius: 8px;
                        object-fit: cover;
                    }
                    .flow-icon.house {
                        width: 80px;
                        height: 60px;
                    }
                    .flow-label {
                        display: flex;
                        flex-direction: column;
                    }
                    .flow-label.right-align {
                        align-items: flex-end;
                    }
                    .flow-title {
                        font-size: 16px;
                        font-weight: 500;
                        color: #374151;
                        margin-bottom: 4px;
                    }
                    .flow-value {
                        font-size: 14px;
                        font-weight: bold;
                        color: #6b7280;
                    }
                    .connection-lines {
                        position: absolute;
                        top: 0;
                        left: 0;
                        width: 100%;
                        height: 100%;
                    }
                    .line {
                        position: absolute;
                        background: #9ca3af;
                        transition: background-color 0.3s ease;
                    }
                    .line-horizontal {
                        height: 3px;
                    }
                    .line-vertical {
                        width: 3px;
                    }
                    .line-prod-house {
                        top: 49px;
                        left: 215px;
                        width: calc(50% - 255px);
                    }
                    .line-house-grid {
                        top: 49px;
                        left: calc(50% + 40px);
                        width: calc(50% - 255px);
                    }
                    .line-house-consumption {
                        top: 220px;
                        left: 50%;
                        transform: translateX(-50%);
                        height: 110px;
                    }
                    .connection-dot {
                        position: absolute;
                        width: 12px;
                        height: 12px;
                        background: #9ca3af;
                        border-radius: 50%;
                        transform: translate(-50%, -50%);
                        transition: background-color 0.3s ease;
                    }
                    .dot-prod {
                        top: 51px;
                        left: 215px;
                    }
                    .dot-house-left {
                        top: 51px;
                        left: calc(50% - 40px);
                    }
                    .dot-house-right {
                        top: 51px;
                        left: calc(50% + 40px);
                    }
                    .dot-grid {
                        top: 51px;
                        left: calc(100% - 215px);
                    }
                    .dot-house-bottom {
                        top: 220px;
                        left: 50%;
                    }
                    .dot-consumption-top {
                        top: 330px;
                        left: 50%;
                    }
                    .positive-flow {
                        background-color: #22c55e !important;
                    }
                    .negative-flow {
                        background-color: #ef4444 !important;
                    }
                    .neutral-flow {
                        background-color: #6b7280 !important;
                    }
                    .no-flow {
                        background-color: #d1d5db !important;
                    }
                    .arrow {
                        position: absolute;
                        font-size: 20px;
                        color: white;
                        font-weight: bold;
                        text-shadow: 1px 1px 2px rgba(0,0,0,0.5);
                        animation: pulse 1s ease-in-out infinite;
                        display: none;
                    }
                    .arrow.show {
                        display: block;
                    }
                    @keyframes pulse {
                        0%, 100% { opacity: 0.7; transform: scale(1); }
                        50% { opacity: 1; transform: scale(1.1); }
                    }
                    .arrow-prod-house {
                        top: 42px;
                        left: calc(215px + (50% - 255px) / 2);
                        transform: translateX(-50%);
                    }
                    .arrow-house-grid {
                        top: 42px;
                        left: calc(50% + 40px + (50% - 255px) / 2);
                        transform: translateX(-50%);
                    }
                    .arrow-house-consumption {
                        top: calc(220px + 55px);
                        left: 50%;
                        transform: translateX(-50%);
                    }
                    @media (max-width: 680px) {
                        .flow-chart {
                            grid-template-columns: 1fr;
                            grid-template-rows: auto;
                            gap: 30px;
                            text-align: center;
                        }
                        .production,
                        .house,
                        .consumption,
                        .grid-section {
                            grid-column: 1;
                            justify-content: center;
                        }
                        .flow-label.right-align {
                            align-items: center;
                        }
                        .connection-lines {
                            display: none;
                        }
                    }
                </style>
                <div class="flow-chart">
                    <div class="production">
                        <img src="./assets/pics/solarPanel.jpeg" alt="Solar Panel" class="flow-icon solar">
                        <div class="flow-label">
                            <div class="flow-title">Production</div>
                            <div class="flow-value" id="production-value">--W</div>
                        </div>
                    </div>
                    <div class="house">
                        <img src="./assets/pics/hous.png" alt="House" class="flow-icon house">
                    </div>
                    <div class="consumption">
                        <img src="./assets/pics/appliances.png" alt="Appliances" class="flow-icon appliances">
                        <div class="flow-label">
                            <div class="flow-title">Consumption</div>
                            <div class="flow-value" id="consumption-value">--W</div>
                        </div>
                    </div>
                    <div class="grid-section">
                        <div class="flow-label right-align">
                            <div class="flow-title">Grid</div>
                            <div class="flow-value" id="grid-value">--W</div>
                        </div>
                        <img src="./assets/pics/power_grid.png" alt="Grid" class="flow-icon grid">
                    </div>
                    <div class="connection-lines">
                        <div class="line line-horizontal line-prod-house" id="line-prod-house"></div>
                        <div class="line line-horizontal line-house-grid" id="line-house-grid"></div>
                        <div class="line line-vertical line-house-consumption" id="line-house-consumption"></div>
                        <div class="connection-dot dot-prod" id="dot-prod"></div>
                        <div class="connection-dot dot-house-left" id="dot-house-left"></div>
                        <div class="connection-dot dot-house-right" id="dot-house-right"></div>
                        <div class="connection-dot dot-grid" id="dot-grid"></div>
                        <div class="connection-dot dot-house-bottom" id="dot-house-bottom"></div>
                        <div class="connection-dot dot-consumption-top" id="dot-consumption-top"></div>
                        <div class="arrow arrow-prod-house" id="arrow-prod-house">→</div>
                        <div class="arrow arrow-house-grid" id="arrow-house-grid">→</div>
                        <div class="arrow arrow-house-consumption" id="arrow-house-consumption">↓</div>
                    </div>
                </div>
                <script>
                    let produc=153.66;
                    document.getElementById('orig-totalProduction').textContent=produc+'MWh';
                    let gridFeed=4.56;
                    document.getElementById('orig-totalGridFeed').textContent=gridFeed+'MWh';
                    let selfUsedRatioval=(produc-gridFeed)*100/produc;
                    document.getElementById('orig-selfUsedRatio').textContent=selfUsedRatioval.toFixed(2)+'%';
                    let co2prevent=produc*0.82/1000*1000;
                    document.getElementById('orig-co2Prevented').textContent=co2prevent.toFixed(2)+'t';
                    let anticipatedYieldval=produc*1000*5+gridFeed*2;
                    document.getElementById('orig-anticipatedYield').textContent=anticipatedYieldval+' INR';
                    function getRandom(min, max) {
                        return Math.random() * (max - min) + min;
                    }
                    let currentProduction = 0;
                    let currentConsumption = 0;
                    let currentGridToHouse = 0;
                    function updatePowerData(productionData, consumptionData, gridToHouseData) {
                        currentProduction = parseFloat(productionData) || 0;
                        currentConsumption = parseFloat(consumptionData) || 0;
                        currentGridToHouse = parseFloat(gridToHouseData) || 0;
                        updateDisplay();
                        updateFlowDirections();
                    }
                    function updateDisplay() {
                        document.getElementById('production-value').textContent = currentProduction.toFixed(1) + 'W';
                        document.getElementById('consumption-value').textContent = currentConsumption.toFixed(1) + 'W';
                        const gridDisplay = currentGridToHouse < 0 ?
                            Math.abs(currentGridToHouse).toFixed(1) + 'W (to Grid)' :
                            currentGridToHouse.toFixed(1) + 'W';
                        document.getElementById('grid-value').textContent = gridDisplay;
                    }
                    function updateFlowDirections() {
                        resetFlowElements();
                        if (currentProduction > 0) {
                            setFlowState('prod-house', 'positive');
                        }
                        if (currentConsumption > 0) {
                            setFlowState('house-consumption', 'neutral');
                        }
                        if (currentGridToHouse > 0) {
                            setFlowState('house-grid', 'negative', true);
                        } else if (currentGridToHouse < 0) {
                            setFlowState('house-grid', 'positive');
                        }
                    }
                    function resetFlowElements() {
                        const elements = ['prod-house', 'house-grid', 'house-consumption'];
                        elements.forEach(element => {
                            setFlowState(element, 'none');
                        });
                    }
                    function setFlowState(connection, state, reverse = false) {
                        const line = document.getElementById(`line-${connection}`);
                        const arrow = document.getElementById(`arrow-${connection}`);
                        const dots = getConnectionDots(connection);
                        if (!line || !arrow) return;
                        line.classList.remove('positive-flow', 'negative-flow', 'neutral-flow', 'no-flow', 'flow-active');
                        dots.forEach(dot => {
                            dot.classList.remove('positive-flow', 'negative-flow', 'neutral-flow', 'no-flow');
                        });
                        if (state === 'none') {
                            line.classList.add('no-flow');
                            dots.forEach(dot => dot.classList.add('no-flow'));
                            arrow.classList.remove('show');
                            return;
                        }
                        let flowClass;
                        switch (state) {
                            case 'positive': flowClass = 'positive-flow'; break;
                            case 'negative': flowClass = 'negative-flow'; break;
                            case 'neutral': flowClass = 'neutral-flow'; break;
                        }
                        line.classList.add(flowClass, 'flow-active');
                        dots.forEach(dot => dot.classList.add(flowClass));
                        arrow.classList.add('show');
                        if (reverse) {
                            if (connection === 'house-grid') {
                                arrow.textContent = '←';
                            }
                        } else {
                            if (connection === 'house-grid') {
                                arrow.textContent = '→';
                            } else if (connection === 'house-consumption') {
                                arrow.textContent = '↓';
                            } else if (connection === 'prod-house') {
                                arrow.textContent = '→';
                            }
                        }
                    }
                    function getConnectionDots(connection) {
                        switch (connection) {
                            case 'prod-house': return [document.getElementById('dot-prod'), document.getElementById('dot-house-left')];
                            case 'house-grid': return [document.getElementById('dot-house-right'), document.getElementById('dot-grid')];
                            case 'house-consumption': return [document.getElementById('dot-house-bottom'), document.getElementById('dot-consumption-top')];
                            default: return [];
                        }
                    }
                    function randomizeFlowChart() {
                        const production = getRandom(100, 5000);
                        const consumption = getRandom(100, 5000);
                        const gridToHouse = consumption - production;
                        updatePowerData(production, consumption, gridToHouse);
                    }
                    setInterval(randomizeFlowChart, 5000);
                    window.addEventListener('DOMContentLoaded', randomizeFlowChart);
                </script>
            </div>

            <!-- Weather Container (35%) -->
            <div class="weather-container">
                <div class="weather-widget">
                    <div class="weather-header">
                        <h1>Weather</h1>
                        <div class="weather-update-info">
                            <span id="weather-update-time">Updated 8 minutes ago</span>
                        </div>
                    </div>
                    <div class="weather-today-weather">
                        <div class="weather-location">West</div>
                        <div class="weather-main-weather">
                            <div class="weather-temperature">40°C</div>
                            <div class="weather-weather-status">
                                <div class="weather-weather-icon">☀️</div>
                                <div class="weather-condition-temp">
                                    <span>Sunny</span>
                                    <span>46/30°C</span>
                                </div>
                            </div>
                        </div>
                        <div class="weather-sun-info">
                            <div class="weather-sun-time">
                                <span class="label">Sunrise</span>
                                <span>05:23</span>
                            </div>
                            <div class="weather-sun-time">
                                <span class="label">Sunset</span>
                                <span>19:19</span>
                            </div>
                        </div>
                    </div>
                    <div class="weather-forecast-section">
                        <div class="weather-forecast-columns">
                            <div class="weather-forecast-column">
                                <div class="weather-day-name">Tuesday 07/08</div>
                                <div class="weather-day-condition">Sunny</div>
                                <div class="weather-day-temp">47/38°C</div>
                            </div>
                            <div class="weather-forecast-column">
                                <div class="weather-day-name">Wednesday 07/09</div>
                                <div class="weather-day-condition">Sunny</div>
                                <div class="weather-day-temp">48/38°C</div>
                            </div>
                            <div class="weather-forecast-column">
                                <div class="weather-day-name">Thursday 07/10</div>
                                <div class="weather-day-condition">Cloudy</div>
                                <div class="weather-day-temp">47/37°C</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Historical Data Chart Section (Original Integration) -->
        <div class="final-chart-container" style="margin-top: 24px;">
            <div class="hist-header">
                <h1 class="hist-title">Historical Data</h1>
                <div class="controls">
                    <div class="date-nav">
                        <button class="nav-btn" id="prevBtn">‹</button>
                        <span class="date-display" id="dateDisplay">2025-06</span>
                        <button class="nav-btn" id="nextBtn">›</button>
                    </div>
                    <div class="view-toggle">
                        <button class="view-btn active" data-view="Month">Month</button>
                        <button class="view-btn" data-view="Year">Year</button>
                        <button class="view-btn" data-view="Total">Total</button>
                    </div>
                </div>
            </div>
            <div class="parameters">
                <h3>Parameters</h3>
                <div class="parameter-grid">
                    <div class="parameter-item">
                        <input type="checkbox" id="production" class="parameter-checkbox" checked>
                        <label for="production" class="parameter-label">
                            <span class="legend-dot" style="background-color: #3b82f6;"></span>Production
                        </label>
                    </div>
                    <div class="parameter-item">
                        <input type="checkbox" id="consumption" class="parameter-checkbox" checked>
                        <label for="consumption" class="parameter-label">
                            <span class="legend-dot" style="background-color: #ef4444;"></span>Consumption
                        </label>
                    </div>
                    <div class="parameter-item">
                        <input type="checkbox" id="gridFeedIn" class="parameter-checkbox">
                        <label for="gridFeedIn" class="parameter-label">
                            <span class="legend-dot" style="background-color: #10b981;"></span>Grid Feed In
                        </label>
                    </div>
                    <div class="parameter-item">
                        <input type="checkbox" id="energyPurchased" class="parameter-checkbox">
                        <label for="energyPurchased" class="parameter-label">
                            <span class="legend-dot" style="background-color: #f59e0b;"></span>Energy Purchased
                        </label>
                    </div>
                    <div class="parameter-item">
                        <input type="checkbox" id="selfUsedRatio" class="parameter-checkbox">
                        <label for="selfUsedRatio" class="parameter-label">
                            <span class="legend-dot" style="background-color: #8b5cf6;"></span>Self Used Ratio
                        </label>
                    </div>
                    <div class="parameter-item">
                        <input type="checkbox" id="anticipatedYield" class="parameter-checkbox">
                        <label for="anticipatedYield" class="parameter-label">
                            <span class="legend-dot" style="background-color: #06b6d4;"></span>Anticipated Yield
                        </label>
                    </div>
                </div>
            </div>
            <div class="chart-container">
                <div class="chart-wrapper">
                    <canvas id="energyChart"></canvas>
                </div>
            </div>
        </div>
    </div>
    <div id="deleteModal" class="delete-modal-overlay">
        <div class="delete-modal-container">
            <div class="delete-modal-header">
                <h2 class="delete-modal-title">Sure to delete?</h2>
                <button class="delete-modal-close" onclick="closeDeleteModal()">×</button>
            </div>
            <div class="delete-modal-body">
                <p class="delete-modal-message">
                    After the deletion, you will not be able to check any data. Continue?
                </p>
                <div class="delete-modal-actions">
                    <button class="delete-modal-btn delete-modal-btn-cancel" onclick="closeDeleteModal()">Cancel</button>
                    <button class="delete-modal-btn delete-modal-btn-confirm" onclick="confirmDelete()">Confirm</button>
                </div>
            </div>
        </div>
    </div>
    <div class="settings-modal-overlay" id="settingsModalOverlay" style="display: none;">
        <div class="settings-modal">
            <div class="settings-modal-header">
                <h2 class="settings-modal-title">Plant Settings</h2>
                <button class="settings-close-button" onclick="closeSettingsModal()">×</button>
            </div>
            
            <div class="settings-modal-body">
                <div class="settings-item">
                    <div class="settings-item-left">
                        <div class="settings-item-title">Calculation of Electric Energy</div>
                        <div class="settings-item-subtitle">All Calculations</div>
                    </div>
                    <div class="settings-item-right">
                        <button class="settings-revise-button" onclick="reviseCalculation()">Revise</button>
                    </div>
                </div>

                <div class="settings-item">
                    <div class="settings-item-left">
                        <div class="settings-item-title">Data Source</div>
                        <div class="settings-item-subtitle">Intelligent Selection</div>
                    </div>
                    <div class="settings-item-right">
                        <button class="settings-revise-button" onclick="reviseDataSource()">Revise</button>
                    </div>
                </div>

                <div class="settings-item">
                    <div class="settings-item-left">
                        <div class="settings-item-title">Plant Non-Working Time Setting</div>
                        <div class="settings-item-subtitle">Off</div>
                    </div>
                    <div class="settings-item-right">
                        <button class="settings-revise-button" onclick="reviseNonWorkingTime()">Revise</button>
                    </div>
                </div>

                <div class="settings-item">
                    <div class="settings-item-left">
                        <div class="settings-item-title">Plant Authorization Restrictions</div>
                        <div class="settings-item-subtitle">The restriction is turned on</div>
                    </div>
                    <div class="settings-item-right">
                        <button class="settings-revise-button" onclick="reviseAuthorization()">Revise</button>
                    </div>
                </div>
            </div>
            
            <div class="settings-modal-footer">
                <button class="settings-authorize-button" onclick="authorize()">Authorize</button>
            </div>
        </div>
    </div>

    <script>
        function toggleSidebar() {
            const sidebar = document.getElementById('sidebar');
            sidebar.classList.toggle('mobile-open');
        }

        // Close sidebar when clicking outside on mobile
        document.addEventListener('click', function(event) {
            const sidebar = document.getElementById('sidebar');
            const menuBtn = document.querySelector('.mobile-menu-btn');
            
            if (window.innerWidth <= 768 && 
                !sidebar.contains(event.target) && 
                !menuBtn.contains(event.target)) {
                sidebar.classList.remove('mobile-open');
            }
        });
    </script>

    <!-- Chart.js and original chart initialization -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="graph.js"></script>
    <script>
    // 24h Curve chart original controls
    function showDataOverview() {
        if (window.powerChart && window.currentData) {
            const overview = `\nProduction Peak: ${Math.max(...window.currentData.productionData).toFixed(2)} MW\nConsumption Peak: ${Math.max(...window.currentData.consumptionData).toFixed(2)} MW\nTotal Production: ${window.currentData.productionData.reduce((sum, val) => sum + val, 0).toFixed(2)} MWh\nTotal Consumption: ${window.currentData.consumptionData.reduce((sum, val) => sum + val, 0).toFixed(2)} MWh`;
            alert(overview);
        }
    }
    // Historical Data chart original logic
    class EnergyDashboard {
        constructor() {
            this.currentYear = 2025;
            this.currentMonth = 6; // June
            this.viewType = 'Month';
            this.chart = null;
            this.colors = {
                production: '#3b82f6',
                consumption: '#ef4444',
                gridFeedIn: '#10b981',
                energyPurchased: '#f59e0b',
                selfUsedRatio: '#8b5cf6',
                anticipatedYield: '#06b6d4'
            };
            this.sampleData = this.generateSampleData();
            this.init();
        }
        generateSampleData() {
            const data = { daily: {}, monthly: {}, yearly: {} };
            for (let year = 2024; year <= 2025; year++) {
                data.daily[year] = {};
                for (let month = 1; month <= 12; month++) {
                    data.daily[year][month] = [];
                    const daysInMonth = new Date(year, month, 0).getDate();
                    for (let day = 1; day <= daysInMonth; day++) {
                        const production = month >= 4 && month <= 9 ? Math.random() * 5 : Math.random() * 2;
                        const consumption = 1 + Math.random() * 3;
                        data.daily[year][month].push({
                            day: day,
                            production: Math.round(production * 100) / 100,
                            consumption: Math.round(consumption * 100) / 100,
                            gridFeedIn: Math.max(0, Math.round((production - consumption) * 100) / 100),
                            energyPurchased: Math.max(0, Math.round((consumption - production) * 100) / 100),
                            selfUsedRatio: production > 0 ? Math.round((Math.min(production, consumption) / production) * 100) : 0,
                            anticipatedYield: Math.round(production * 1.1 * 100) / 100
                        });
                    }
                }
            }
            return data;
        }
        init() {
            this.setupEventListeners();
            this.updateDateDisplay();
            this.renderChart();
        }
        setupEventListeners() {
            document.getElementById('prevBtn').addEventListener('click', () => this.navigatePrevious());
            document.getElementById('nextBtn').addEventListener('click', () => this.navigateNext());
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.addEventListener('click', (e) => this.setViewType(e.target.dataset.view));
            });
            document.querySelectorAll('.parameter-checkbox').forEach(checkbox => {
                checkbox.addEventListener('change', () => this.renderChart());
            });
        }
        navigatePrevious() {
            if (this.viewType === 'Month') {
                if (this.currentMonth === 1) {
                    this.currentMonth = 12;
                    this.currentYear--;
                } else {
                    this.currentMonth--;
                }
            } else if (this.viewType === 'Year') {
                this.currentYear--;
            }
            this.updateDateDisplay();
            this.renderChart();
        }
        navigateNext() {
            if (this.viewType === 'Month') {
                if (this.currentMonth === 12) {
                    this.currentMonth = 1;
                    this.currentYear++;
                } else {
                    this.currentMonth++;
                }
            } else if (this.viewType === 'Year') {
                this.currentYear++;
            }
            this.updateDateDisplay();
            this.renderChart();
        }
        setViewType(viewType) {
            this.viewType = viewType;
            document.querySelectorAll('.view-btn').forEach(btn => {
                btn.classList.toggle('active', btn.dataset.view === viewType);
            });
            this.updateDateDisplay();
            this.renderChart();
        }
        updateDateDisplay() {
            const display = document.getElementById('dateDisplay');
            if (this.viewType === 'Month') {
                display.textContent = `${this.currentYear}-${String(this.currentMonth).padStart(2, '0')}`;
            } else if (this.viewType === 'Year') {
                display.textContent = this.currentYear;
            } else {
                display.textContent = 'Total';
            }
        }
        getSelectedParameters() {
            const selected = {};
            document.querySelectorAll('.parameter-checkbox').forEach(checkbox => {
                selected[checkbox.id] = checkbox.checked;
            });
            return selected;
        }
        getChartData() {
            const selectedParams = this.getSelectedParameters();
            let data = [];
            let labels = [];
            if (this.viewType === 'Month') {
                const monthData = this.sampleData.daily[this.currentYear]?.[this.currentMonth] || [];
                data = monthData;
                labels = monthData.map(d => d.day);
            } else if (this.viewType === 'Year') {
                data = [];
                labels = [];
                for (let month = 1; month <= 12; month++) {
                    const monthData = this.sampleData.daily[this.currentYear]?.[month] || [];
                    const monthTotal = {
                        month: month,
                        production: monthData.reduce((sum, d) => sum + d.production, 0),
                        consumption: monthData.reduce((sum, d) => sum + d.consumption, 0),
                        gridFeedIn: monthData.reduce((sum, d) => sum + d.gridFeedIn, 0),
                        energyPurchased: monthData.reduce((sum, d) => sum + d.energyPurchased, 0),
                        selfUsedRatio: monthData.length > 0 ? monthData.reduce((sum, d) => sum + d.selfUsedRatio, 0) / monthData.length : 0,
                        anticipatedYield: monthData.reduce((sum, d) => sum + d.anticipatedYield, 0)
                    };
                    data.push(monthTotal);
                    labels.push(new Date(2000, month - 1).toLocaleString('default', { month: 'short' }));
                }
            } else {
                data = [];
                labels = [];
                for (let year = 2022; year <= 2025; year++) {
                    let yearTotal = {
                        year: year,
                        production: 0,
                        consumption: 0,
                        gridFeedIn: 0,
                        energyPurchased: 0,
                        selfUsedRatio: 0,
                        anticipatedYield: 0
                    };
                    let totalDays = 0;
                    for (let month = 1; month <= 12; month++) {
                        const monthData = this.sampleData.daily[year]?.[month] || [];
                        yearTotal.production += monthData.reduce((sum, d) => sum + d.production, 0);
                        yearTotal.consumption += monthData.reduce((sum, d) => sum + d.consumption, 0);
                        yearTotal.gridFeedIn += monthData.reduce((sum, d) => sum + d.gridFeedIn, 0);
                        yearTotal.energyPurchased += monthData.reduce((sum, d) => sum + d.energyPurchased, 0);
                        yearTotal.selfUsedRatio += monthData.reduce((sum, d) => sum + d.selfUsedRatio, 0);
                        yearTotal.anticipatedYield += monthData.reduce((sum, d) => sum + d.anticipatedYield, 0);
                        totalDays += monthData.length;
                    }
                    if (totalDays > 0) {
                        yearTotal.selfUsedRatio = yearTotal.selfUsedRatio / totalDays;
                    }
                    data.push(yearTotal);
                    labels.push(year);
                }
            }
            return { data, labels, selectedParams };
        }
        renderChart() {
            const ctx = document.getElementById('energyChart').getContext('2d');
            const { data, labels, selectedParams } = this.getChartData();
            if (this.chart) {
                this.chart.destroy();
            }
            const datasets = [];
            Object.keys(selectedParams).forEach(param => {
                if (selectedParams[param]) {
                    datasets.push({
                        label: this.getParameterLabel(param),
                        data: data.map(d => d[param] || 0),
                        backgroundColor: this.colors[param],
                        borderColor: this.colors[param],
                        borderWidth: 1
                    });
                }
            });
            this.chart = new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: labels,
                    datasets: datasets
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'kWh'
                            }
                        },
                        x: {
                            title: {
                                display: true,
                                text: this.getXAxisLabel()
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: true,
                            position: 'top'
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    }
                }
            });
        }
        getParameterLabel(param) {
            const labels = {
                production: 'Production',
                consumption: 'Consumption',
                gridFeedIn: 'Grid Feed In',
                energyPurchased: 'Energy Purchased',
                selfUsedRatio: 'Self Used Ratio (%)',
                anticipatedYield: 'Anticipated Yield'
            };
            return labels[param] || param;
        }
        getXAxisLabel() {
            if (this.viewType === 'Month') return 'Day';
            if (this.viewType === 'Year') return 'Month';
            return 'Year';
        }
    }
    document.addEventListener('DOMContentLoaded', () => {
        new EnergyDashboard();
    });
    function showDeleteModal() {
            const modal = document.getElementById('deleteModal');
            
            if (!modal) {
                console.error('Delete modal not found');
                return;
            }
            
            // Show modal with animation
            modal.style.display = 'flex';
            document.body.classList.add('modal-open');
            
            // Trigger animation
            setTimeout(() => {
                modal.classList.add('active');
            }, 10);
        }

        /**
         * Close delete modal
         */
        function closeDeleteModal() {
            const modal = document.getElementById('deleteModal');
            
            if (!modal) {
                console.error('Delete modal not found');
                return;
            }
            
            // Hide modal with animation
            modal.classList.remove('active');
            
            setTimeout(() => {
                modal.style.display = 'none';
                document.body.classList.remove('modal-open');
            }, 300);
        }

        /**
         * Confirm deletion
         */
        function confirmDelete() {
            console.log('Item deleted');
            alert('Item has been deleted successfully!');
            closeDeleteModal();
        }
        function openSettingsModal() {
            document.getElementById('settingsModalOverlay').style.display = 'flex';
        }

        function closeSettingsModal() {
            document.getElementById('settingsModalOverlay').style.display = 'none';
        }

        function reviseCalculation() {
            console.log('Revising Calculation of Electric Energy');
        }

        function reviseDataSource() {
            console.log('Revising Data Source');
        }

        function reviseNonWorkingTime() {
            console.log('Revising Plant Non-Working Time Setting');
        }

        function reviseAuthorization() {
            console.log('Revising Plant Authorization Restrictions');
        }

        function authorize() {
            console.log('Authorizing plant settings');
            closeSettingsModal();
        }

        // Close modal when clicking outside
        document.getElementById('settingsModalOverlay').addEventListener('click', function(e) {
            if (e.target === this) {
                closeSettingsModal();
            }
        });
    </script>
</body>
</html>